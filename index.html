<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arrow Key Game</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div id="main-container">
      <div id="top-bar">
        <span id="high-score-label"
          >High Score: <span id="high-score">0</span></span
        >
        <span id="timer">Time: 30s</span>
      </div>
      <h1>Arrow Key Game</h1>
      <p id="instructions">
        Press the arrow key that matches the arrow shown below.<br />
        <span class="instructions-hint"
          >Try to match as many arrows as you can before time runs out!</span
        >
      </p>
      <div id="arrow-trace"><span class="arrow-trace-icon">↑</span></div>
      <div id="arrow-container">
        <span id="arrow-icon" class="arrow-trace-icon"></span>
      </div>
      <div id="score">Score: 0</div>
      <div id="time-controls">
        <button class="time-option" data-time="30">30s</button>
        <button class="time-option" data-time="45">45s</button>
        <button class="time-option" data-time="60">60s</button>
      </div>
      <button id="restart-btn" aria-label="Start or End Game">
        Start Game
      </button>
      <span id="restart-hint">(or press Space Bar to start/end)</span>
      <div id="final-score"></div>
    </div>
    <script>
      const arrows = [
        { key: "ArrowUp", symbol: "↑" },
        { key: "ArrowDown", symbol: "↓" },
        { key: "ArrowLeft", symbol: "←" },
        { key: "ArrowRight", symbol: "→" },
      ];
      let score = 0;
      let highScores = { 30: 0, 45: 0, 60: 0 };
      let currentArrow = null;
      let timeLeft = 30;
      let timerInterval = null;
      let gameActive = false;
      let gameStarted = false;
      let selectedTime = 30;

      function showRandomArrow() {
        // If first move, use the pre-selected arrow
        if (!gameStarted && window.nextArrowForStart) {
          currentArrow = window.nextArrowForStart;
        } else {
          currentArrow = arrows[Math.floor(Math.random() * arrows.length)];
        }
        const arrowIcon = document.getElementById("arrow-icon");
        arrowIcon.textContent = currentArrow.symbol;
        arrowIcon.className = "";
        document
          .getElementById("arrow-container")
          .setAttribute(
            "aria-label",
            currentArrow.key.replace("Arrow", "") + " Arrow"
          );
        // After first move, clear the pre-selected arrow
        if (window.nextArrowForStart) window.nextArrowForStart = null;
      }

      function updateScore() {
        document.getElementById("score").textContent = `Score: ${score}`;
      }

      function updateHighScore() {
        document.getElementById("high-score").textContent =
          highScores[selectedTime] || 0;
        localStorage.setItem("arrowGameHighScores", JSON.stringify(highScores));
      }

      function updateTimer() {
        document.getElementById("timer").textContent = `Time: ${timeLeft}s`;
      }

      function resetGameUI() {
        score = 0;
        timeLeft = selectedTime;
        gameActive = false;
        gameStarted = false;
        document.getElementById("final-score").style.display = "none";
        document.getElementById("restart-btn").textContent = "Start Game";
        document.getElementById("restart-btn").disabled = false;
        // Only pick a new arrow if not already set
        if (!window.nextArrowForStart) {
          window.nextArrowForStart =
            arrows[Math.floor(Math.random() * arrows.length)];
        }
        const arrowIcon = document.getElementById("arrow-icon");
        arrowIcon.textContent = window.nextArrowForStart.symbol;
        arrowIcon.className = "arrow-trace-icon";
        updateScore();
        updateTimer();
        // Always show time controls, full opacity when not started
        document.getElementById("time-controls").classList.remove("faded");
        document.querySelectorAll(".time-option").forEach((btn) => {
          btn.classList.remove("selected");
          if (parseInt(btn.getAttribute("data-time")) === selectedTime) {
            btn.classList.add("selected");
          }
          btn.disabled = false;
        });
      }

      function endGame(resetOnly = false) {
        gameActive = false;
        gameStarted = false;
        clearInterval(timerInterval);
        timeLeft = selectedTime; // Reset time to selected value
        if (!resetOnly) {
          document.getElementById("final-score").style.display = "block";
          document.getElementById(
            "final-score"
          ).textContent = `Game Over! Your final score: ${score}`;
        } else {
          document.getElementById("final-score").style.display = "none";
        }
        // Update high score for current time
        if (score > (highScores[selectedTime] || 0)) {
          highScores[selectedTime] = score;
          updateHighScore();
        } else {
          updateHighScore();
        }
        // Do NOT pick a new arrow here, keep the same for next start
        const arrowIcon = document.getElementById("arrow-icon");
        if (window.nextArrowForStart) {
          arrowIcon.textContent = window.nextArrowForStart.symbol;
        } else {
          // fallback: pick a random arrow if missing
          const fallbackArrow =
            arrows[Math.floor(Math.random() * arrows.length)];
          arrowIcon.textContent = fallbackArrow.symbol;
          window.nextArrowForStart = fallbackArrow;
        }
        arrowIcon.className = "arrow-trace-icon";
        document.getElementById("restart-btn").textContent = "Start Game";
        document.getElementById("restart-btn").disabled = false;
        // Restore time controls to full opacity and enable buttons
        document.getElementById("time-controls").classList.remove("faded");
        document.querySelectorAll(".time-option").forEach((btn) => {
          btn.disabled = false;
        });
        updateTimer(); // Update timer display
      }

      function startGame() {
        if (gameStarted) return; // Prevent multiple starts
        score = 0;
        timeLeft = selectedTime;
        gameActive = true;
        gameStarted = true;
        document.getElementById("final-score").style.display = "none";
        document.getElementById("restart-btn").textContent = "End Game";
        document.getElementById("restart-btn").disabled = false;
        updateScore();
        updateTimer();
        // Always use the pre-selected arrow for first move
        if (window.nextArrowForStart) {
          currentArrow = window.nextArrowForStart;
          const arrowIcon = document.getElementById("arrow-icon");
          arrowIcon.textContent = currentArrow.symbol;
          arrowIcon.className = "";
          document
            .getElementById("arrow-container")
            .setAttribute(
              "aria-label",
              currentArrow.key.replace("Arrow", "") + " Arrow"
            );
          window.nextArrowForStart = null;
        } else {
          showRandomArrow();
        }
        // Fade time controls and disable buttons during game
        document.getElementById("time-controls").classList.add("faded");
        document.querySelectorAll(".time-option").forEach((btn) => {
          btn.disabled = true;
        });
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(() => {
          timeLeft--;
          updateTimer();
          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            if (score > (highScores[selectedTime] || 0)) {
              highScores[selectedTime] = score;
              updateHighScore();
            }
            endGame();
          }
        }, 1000);
      }

      function showScorePenaltyAnimation() {
        let penaltyElem = document.getElementById("score-penalty");
        if (!penaltyElem) {
          penaltyElem = document.createElement("div");
          penaltyElem.id = "score-penalty";
          penaltyElem.textContent = "-2";
          penaltyElem.style.position = "absolute";
          penaltyElem.style.left = "50%";
          penaltyElem.style.top = "calc(50% + 60px)";
          penaltyElem.style.transform = "translate(-50%, 0)";
          penaltyElem.style.fontSize = "48px";
          penaltyElem.style.color = "#d32f2f";
          penaltyElem.style.fontWeight = "700";
          penaltyElem.style.opacity = "0";
          penaltyElem.style.pointerEvents = "none";
          penaltyElem.style.transition = "opacity 0.3s, top 0.5s";
          penaltyElem.style.zIndex = "10";
          document.getElementById("main-container").appendChild(penaltyElem);
        }
        penaltyElem.style.opacity = "1";
        penaltyElem.style.top = "calc(50% + 10px)";
        setTimeout(() => {
          penaltyElem.style.opacity = "0";
          penaltyElem.style.top = "calc(50% + 60px)";
        }, 600);
      }

      // When time is changed, update high score display
      function handleTimeChange(newTime) {
        selectedTime = newTime;
        timeLeft = selectedTime;
        updateTimer();
        updateHighScore();
        document.querySelectorAll(".time-option").forEach((btn) => {
          btn.classList.remove("selected");
          if (parseInt(btn.getAttribute("data-time")) === selectedTime) {
            btn.classList.add("selected");
          }
        });
      }

      document.addEventListener("keydown", function (event) {
        // Toggle start/end game with space bar
        if (event.code === "Space") {
          if (!gameActive) {
            startGame();
          } else {
            endGame(true); // End and reset everything except high score
          }
          return;
        }
        // Start game with Enter (but do NOT end it)
        if (event.code === "Enter" && !gameActive) {
          startGame();
          return;
        }
        // End game with Escape
        if (event.code === "Escape" && gameActive) {
          endGame(true);
          return;
        }
        // Change time selection with left/right arrow before game starts
        if (!gameStarted && ["ArrowLeft", "ArrowRight"].includes(event.code)) {
          const times = [30, 45, 60];
          let idx = times.indexOf(selectedTime);
          if (event.code === "ArrowLeft" && idx > 0) {
            handleTimeChange(times[idx - 1]);
          } else if (event.code === "ArrowRight" && idx < times.length - 1) {
            handleTimeChange(times[idx + 1]);
          }
          return;
        }
        if (!gameActive || !currentArrow) return;
        if (
          ["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].includes(
            event.key
          )
        ) {
          if (event.key === currentArrow.key) {
            score++;
          } else {
            score -= 2;
            showScorePenaltyAnimation();
          }
          updateScore();
          showRandomArrow();
        }
      });

      document
        .getElementById("restart-btn")
        .addEventListener("click", function () {
          if (!gameActive) {
            startGame();
          } else {
            endGame(true);
          }
        });

      // Time option buttons logic
      document.querySelectorAll(".time-option").forEach((btn) => {
        btn.addEventListener("click", function () {
          if (!gameStarted) {
            handleTimeChange(parseInt(btn.getAttribute("data-time")));
          }
        });
      });

      // Load high scores from localStorage if available
      if (localStorage.getItem("arrowGameHighScores")) {
        try {
          highScores = JSON.parse(localStorage.getItem("arrowGameHighScores"));
          if (!highScores || typeof highScores !== "object")
            highScores = { 30: 0, 45: 0, 60: 0 };
        } catch {
          highScores = { 30: 0, 45: 0, 60: 0 };
        }
        updateHighScore();
      }
      // Clear high scores on refresh
      window.addEventListener("load", function () {
        localStorage.removeItem("arrowGameHighScores");
        highScores = { 30: 0, 45: 0, 60: 0 };
        updateHighScore();
      });

      // Initial UI state
      resetGameUI();

      // Remove tab focus from all buttons and focusable elements
      // Set tabindex="-1" for all relevant elements after DOM is loaded
      window.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll("button, [tabindex]").forEach((el) => {
          el.setAttribute("tabindex", "-1");
        });
      });
    </script>
  </body>
</html>
<style>
  body {
    font-family: "Montserrat", "Roboto", Arial, sans-serif;
    background: #f5f6fa;
    color: #212121;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: flex;
    align-items: stretch;
    justify-content: stretch;
  }
  #main-container {
    background: #fff;
    border-radius: 24px;
    box-shadow: 0 4px 24px rgba(60, 64, 67, 0.12);
    padding: 40px 56px 32px 56px;
    max-width: 700px;
    width: 100%;
    min-height: 70vh;
    margin: 48px auto;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    transition: box-shadow 0.3s, background 0.3s;
  }
  #top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    margin-bottom: 24px;
    font-size: 22px;
  }
  #high-score-label {
    color: #1a73e8;
    font-weight: 500;
    letter-spacing: 1px;
  }
  #timer {
    color: #388e3c;
    font-weight: 500;
    letter-spacing: 1px;
  }
  h1 {
    color: #1a73e8;
    margin-top: 0;
    margin-bottom: 12px;
    font-size: 2.5rem;
    font-weight: 700;
    letter-spacing: 1px;
  }
  #instructions {
    font-size: 1.1rem;
    margin-bottom: 20px;
    color: #5f6368;
    font-weight: 400;
  }
  #arrow-trace {
    text-align: center;
    margin-bottom: -60px;
    margin-top: 10px;
    pointer-events: none;
    display: block;
  }
  #arrow-container {
    font-size: 220px;
    margin: 32px 0 20px 0;
    min-height: 220px;
    transition: color 0.2s, transform 0.1s;
    color: #1a73e8;
    user-select: none;
    -webkit-user-select: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 0;
    background: none;
    box-shadow: none;
    width: auto;
    height: auto;
    margin-left: auto;
    margin-right: auto;
  }
  /* Update .arrow-trace-icon style for faded arrow at start */
  .arrow-trace-icon {
    color: #1a73e8;
    opacity: 0.18;
    transition: opacity 0.3s;
  }
  #arrow-container:active {
    transform: scale(1.12);
    color: #388e3c;
    background: none;
    box-shadow: none;
  }
  #score {
    font-size: 32px;
    margin-bottom: 18px;
    color: #388e3c;
    font-weight: 600;
    letter-spacing: 1px;
  }
  #time-controls {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 22px;
    transition: opacity 0.3s;
  }
  #time-controls.faded {
    opacity: 0.13;
    pointer-events: none;
  }
  .time-option {
    font-size: 18px;
    padding: 6px 18px;
    background: #e8eaed;
    color: #1a73e8;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: background 0.2s, color 0.2s;
    box-shadow: 0 1px 4px rgba(60, 64, 67, 0.06);
  }
  .time-option.selected {
    background: #1a73e8;
    color: #fff;
  }
  .time-option:disabled {
    background: #f1f3f4;
    color: #bdbdbd;
    cursor: not-allowed;
  }
  #restart-btn {
    font-size: 20px;
    padding: 14px 36px;
    background: #1a73e8;
    color: #fff;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    margin-bottom: 16px;
    transition: background 0.2s, box-shadow 0.2s;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(60, 64, 67, 0.1);
    letter-spacing: 1px;
  }
  #restart-btn:disabled {
    background: #e8eaed;
    color: #bdbdbd;
    cursor: not-allowed;
  }
  #restart-btn:hover:not(:disabled) {
    background: #388e3c;
    color: #fff;
    box-shadow: 0 4px 16px rgba(60, 64, 67, 0.14);
  }
  #restart-hint {
    display: block;
    font-size: 15px;
    margin-bottom: 14px;
    color: #5f6368;
    font-weight: 400;
  }
  #final-score {
    display: none;
    font-size: 28px;
    margin-top: 24px;
    color: #1a73e8;
    font-weight: 600;
    letter-spacing: 1px;
    border-radius: 8px;
    padding: 12px 0;
    box-shadow: none;
    background: none;
  }
  .instructions-hint {
    font-size: 15px;
    color: #5f6368;
  }
  @media (max-width: 1200px) {
    #main-container {
      max-width: 90vw;
      padding: 28px 3vw 20px 3vw;
      min-height: 60vh;
      margin: 32px auto;
    }
    #arrow-container {
      font-size: 160px;
      min-height: 160px;
      margin: 24px 0 16px 0;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 10px;
    }
    #score {
      font-size: 26px;
      margin-bottom: 14px;
    }
    #final-score {
      font-size: 20px;
      margin-top: 18px;
    }
    #restart-btn {
      font-size: 17px;
      padding: 10px 28px;
      margin-bottom: 12px;
    }
    #time-controls {
      gap: 8px;
      margin-bottom: 16px;
    }
    .time-option {
      font-size: 16px;
      padding: 5px 14px;
    }
  }
  @media (max-width: 900px) {
    #main-container {
      max-width: 98vw;
      padding: 18px 4vw 12px 4vw;
      min-height: 60vh;
    }
    #arrow-container {
      font-size: 120px;
      min-height: 120px;
      width: auto;
      height: auto;
    }
    h1 {
      font-size: 1.7rem;
    }
    #score {
      font-size: 22px;
    }
    #final-score {
      font-size: 18px;
    }
    #restart-btn {
      font-size: 16px;
      padding: 10px 24px;
    }
    #time-controls button {
      font-size: 15px;
      padding: 4px 10px;
    }
    #selected-time {
      font-size: 15px;
    }
  }
  @media (max-width: 600px) {
    #main-container {
      padding: 8px 1vw 6px 1vw;
      min-height: 40vh;
    }
    #arrow-container {
      font-size: 70px;
      min-height: 70px;
      width: auto;
      height: auto;
    }
    h1 {
      font-size: 1.1rem;
    }
    #score {
      font-size: 15px;
    }
    #final-score {
      font-size: 13px;
    }
    #restart-btn {
      font-size: 13px;
      padding: 6px 12px;
    }
    #time-controls button {
      font-size: 12px;
      padding: 2px 6px;
    }
    #selected-time {
      font-size: 12px;
    }
  }
  #score-penalty {
    pointer-events: none;
  }
</style>
